<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢—Ä–µ–∫–µ—Ä –≤—Ä–µ–º–µ–Ω–∏</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a2e; --card2:#0c1527;
      --text:#e8eefc; --muted:#9fb0d0; --line:#223255;
      --accent:#4da3ff; --danger:#ff5b5b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,#070c16,var(--bg));
      color:var(--text);
      padding:16px;
    }
    .wrap{max-width:760px;margin:0 auto}
    h1{margin:0 0 12px;font-size:22px}
    .card{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      margin-bottom:12px;
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    input, button{
      border-radius:12px;
      border:1px solid var(--line);
      background:#0a1324;
      color:var(--text);
      padding:12px 12px;
      font-size:16px;
      outline:none;
    }
    input::placeholder{color:#6f82aa}
    button{
      background:rgba(77,163,255,.15);
      border:1px solid rgba(77,163,255,.35);
      cursor:pointer;
      user-select:none;
    }
    button:active{transform:scale(.99)}
    button.secondary{
      background:rgba(255,255,255,.06);
      border-color:rgba(255,255,255,.10);
    }
    button.danger{
      background:rgba(255,91,91,.12);
      border-color:rgba(255,91,91,.35);
    }
    .stats{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .stat{
      padding:12px;
      border-radius:14px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
    }
    .stat .k{color:var(--muted); font-size:13px}
    .stat .v{font-size:20px; margin-top:4px}
    .bar{
      height:10px;
      border-radius:999px;
      overflow:hidden;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      margin-top:12px;
    }
    .fill{height:100%; width:0%; background:var(--accent)}
    .hint{color:var(--muted); font-size:13px; margin-top:8px; line-height:1.35}
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (max-width:620px){ .grid{grid-template-columns:1fr} .stats{grid-template-columns:1fr 1fr} }
    .tile{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.07);
      background:rgba(255,255,255,.03);
    }
    .tile .left{display:flex; gap:10px; align-items:center; min-width:0}
    .icon{
      width:44px;height:44px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      font-size:22px;
      flex:0 0 auto;
    }
    .name{font-weight:650; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .sub{color:var(--muted); font-size:13px; margin-top:2px}
    .tile .actions{display:flex; gap:8px; flex:0 0 auto}
    .mini{padding:10px 10px; font-size:14px; border-radius:12px}
    .list{margin-top:10px}
    .item{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.07);
      background:rgba(255,255,255,.03);
      margin-top:8px;
    }
    .item .l{min-width:0}
    .item .title{font-weight:650}
    .item .meta{color:var(--muted); font-size:13px; margin-top:2px}
    dialog{
      border:none;
      padding:0;
      border-radius:18px;
      background:transparent;
      width:min(760px, 96vw);
      color:var(--text);
    }
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .modal{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      box-shadow:0 20px 60px rgba(0,0,0,.45);
    }
    .modal h2{margin:0 0 10px;font-size:18px}
    canvas{width:100%; height:240px; background:rgba(255,255,255,.02); border:1px solid rgba(255,255,255,.06); border-radius:14px}
    .topcats{margin-top:10px}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      margin:6px 6px 0 0;
      font-size:13px;
      color:var(--text);
    }
    .pill .m{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>–¢—Ä–µ–∫–µ—Ä –¥–Ω—è (24 —á–∞—Å–∞)</h1>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div style="font-weight:700">–°–µ–≥–æ–¥–Ω—è: <span id="todayLabel"></span></div>
          <div class="hint">–î–æ–±–∞–≤–ª—è–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—ç–º–æ–¥–∑–∏ + –Ω–∞–∑–≤–∞–Ω–∏–µ), –ø–æ—Ç–æ–º –Ω–∞–∂–∏–º–∞–π ¬´+ –º–∏–Ω—É—Ç—ã¬ª. –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.</div>
        </div>
        <div class="row">
          <button class="secondary" id="weekBtn">–ì—Ä–∞—Ñ–∏–∫ –∑–∞ –Ω–µ–¥–µ–ª—é</button>
          <button class="danger" id="newDayBtn">–ù–æ–≤—ã–π –¥–µ–Ω—å</button>
        </div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="k">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
          <div class="v" id="spent">0 –º–∏–Ω</div>
        </div>
        <div class="stat">
          <div class="k">–û—Å—Ç–∞–ª–æ—Å—å</div>
          <div class="v" id="left">1440 –º–∏–Ω</div>
        </div>
        <div class="stat">
          <div class="k">–ó–∞–ø–∏—Å–µ–π</div>
          <div class="v" id="count">0</div>
        </div>
      </div>

      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="hint">–ï—Å–ª–∏ –ø–æ—Ç—Ä–∞—Ç–∏—à—å –±–æ–ª—å—à–µ 1440 –º–∏–Ω—É—Ç, —è –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ—Å—á–∏—Ç–∞—é ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.</div>
    </div>

    <div class="card">
      <div style="font-weight:700; margin-bottom:8px">1) –°–æ–∑–¥–∞—Ç—å ¬´–∏–∫–æ–Ω–∫—É¬ª (–∫–∞—Ç–µ–≥–æ—Ä–∏—é)</div>
      <div class="row">
        <input id="catEmoji" placeholder="–≠–º–æ–¥–∑–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä üé§)" style="width:180px" />
        <input id="catName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (—Ä–∞–±–æ—Ç–∞, —Å–ø–æ—Ä—Ç, –≤–æ–∫–∞–ª)" style="flex:1; min-width:220px" />
        <button id="addCatBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <div class="hint">–°–æ–≤–µ—Ç: —ç–º–æ–¥–∑–∏ –ª—É—á—à–µ 1 —Å–∏–º–≤–æ–ª. –ü—Ä–∏–º–µ—Ä—ã: üíº –†–∞–±–æ—Ç–∞, üèãÔ∏è –°–ø–æ—Ä—Ç, üé§ –í–æ–∫–∞–ª, üë®‚Äçüë©‚Äçüëß –°–µ–º—å—è.</div>
    </div>

    <div class="card">
      <div style="font-weight:700; margin-bottom:8px">2) –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–∂–º–∏ ¬´+ –º–∏–Ω—É—Ç—ã¬ª)</div>
      <div id="cats" class="grid"></div>
      <div class="hint">–£ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ –º–∏–Ω—É—Ç –∑–∞ —Å–µ–≥–æ–¥–Ω—è.</div>
    </div>

    <div class="card">
      <div style="font-weight:700">–ó–∞–ø–∏—Å–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
      <div id="entries" class="list"></div>
      <div class="hint">–ú–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏.</div>
    </div>
  </div>

  <dialog id="weekDialog">
    <div class="modal">
      <div class="row" style="justify-content:space-between">
        <h2>3) –ì—Ä–∞—Ñ–∏–∫ –∑–∞ –Ω–µ–¥–µ–ª—é</h2>
        <button class="secondary" id="closeWeek">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>

      <canvas id="weekCanvas" width="900" height="360"></canvas>

      <div class="topcats">
        <div style="font-weight:700; margin-top:10px">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∑–∞ 7 –¥–Ω–µ–π</div>
        <div id="topCats"></div>
      </div>

      <div class="hint" style="margin-top:10px">
        –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∏–Ω—É—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –¥–Ω—é (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π, –≤–∫–ª—é—á–∞—è —Å–µ–≥–æ–¥–Ω—è).
      </div>
    </div>
  </dialog>

<script>
/** ====== Storage Schema ======
state = {
  categories: [{id, emoji, name}],
  days: {
     "YYYY-MM-DD": {
        entries: [{id, catId, minutes, ts}],
     }
  }
}
*/
const STORE_KEY = "tt_state_v2";
const DAY_MINUTES = 1440;

const $ = (id) => document.getElementById(id);

function nowTs(){ return Date.now(); }

function pad(n){ return String(n).padStart(2,"0"); }
function dayKey(d = new Date()){
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}
function fmtDateRu(key){
  const [y,m,dd] = key.split("-").map(Number);
  const d = new Date(y, m-1, dd);
  return d.toLocaleDateString("ru-RU", { weekday:"short", day:"2-digit", month:"2-digit" });
}
function clampInt(n){
  const x = Number(n);
  if (!Number.isFinite(x)) return 0;
  return Math.max(0, Math.round(x));
}
function uid(){
  return Math.random().toString(16).slice(2) + "-" + Math.random().toString(16).slice(2);
}

function loadState(){
  try{
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw) return { categories: seedCats(), days: {} };
    const s = JSON.parse(raw);
    if(!s.categories) s.categories = seedCats();
    if(!s.days) s.days = {};
    return s;
  }catch(e){
    return { categories: seedCats(), days: {} };
  }
}
function saveState(){
  localStorage.setItem(STORE_KEY, JSON.stringify(state));
}

function seedCats(){
  return [
    {id: uid(), emoji:"üíº", name:"–†–∞–±–æ—Ç–∞"},
    {id: uid(), emoji:"üèãÔ∏è", name:"–°–ø–æ—Ä—Ç"},
    {id: uid(), emoji:"üé§", name:"–í–æ–∫–∞–ª"},
    {id: uid(), emoji:"üò¥", name:"–°–æ–Ω"},
  ];
}

let state = loadState();
let today = dayKey();

function ensureToday(){
  if(!state.days[today]) state.days[today] = { entries: [] };
}

function getTodayEntries(){
  ensureToday();
  return state.days[today].entries;
}

function sumToday(){
  return getTodayEntries().reduce((a,e)=>a+e.minutes,0);
}
function sumTodayByCat(catId){
  return getTodayEntries().filter(e=>e.catId===catId).reduce((a,e)=>a+e.minutes,0);
}

function renderHeader(){
  $("todayLabel").textContent = new Date().toLocaleDateString("ru-RU", { day:"2-digit", month:"long", year:"numeric" });
}

function renderStats(){
  const spent = sumToday();
  const left = DAY_MINUTES - spent;

  $("spent").textContent = `${spent} –º–∏–Ω`;
  $("left").textContent = `${left} –º–∏–Ω`;
  $("count").textContent = String(getTodayEntries().length);

  const pct = Math.min(200, Math.max(0, (spent / DAY_MINUTES) * 100)); // can exceed 100, cap at 200 for UI
  $("fill").style.width = `${Math.min(100, pct)}%`;
  $("fill").style.background = pct <= 100 ? "var(--accent)" : "var(--danger)";
}

function renderCats(){
  const box = $("cats");
  box.innerHTML = "";

  for(const c of state.categories){
    const total = sumTodayByCat(c.id);

    const tile = document.createElement("div");
    tile.className = "tile";

    const left = document.createElement("div");
    left.className = "left";

    const icon = document.createElement("div");
    icon.className = "icon";
    icon.textContent = c.emoji || "üî∑";

    const text = document.createElement("div");
    const name = document.createElement("div");
    name.className = "name";
    name.textContent = c.name || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
    const sub = document.createElement("div");
    sub.className = "sub";
    sub.textContent = `–°–µ–≥–æ–¥–Ω—è: ${total} –º–∏–Ω`;

    text.appendChild(name);
    text.appendChild(sub);

    left.appendChild(icon);
    left.appendChild(text);

    const actions = document.createElement("div");
    actions.className = "actions";

    const addBtn = document.createElement("button");
    addBtn.className = "mini";
    addBtn.textContent = "+ –º–∏–Ω—É—Ç—ã";
    addBtn.onclick = () => addMinutesFlow(c.id);

    const delBtn = document.createElement("button");
    delBtn.className = "mini danger";
    delBtn.textContent = "–£–¥–∞–ª–∏—Ç—å";
    delBtn.onclick = () => deleteCategory(c.id);

    actions.appendChild(addBtn);
    actions.appendChild(delBtn);

    tile.appendChild(left);
    tile.appendChild(actions);

    box.appendChild(tile);
  }
}

function renderEntries(){
  const box = $("entries");
  const entries = getTodayEntries().slice().sort((a,b)=>b.ts-a.ts);
  box.innerHTML = "";

  if(entries.length === 0){
    const empty = document.createElement("div");
    empty.className = "hint";
    empty.textContent = "–ü–æ–∫–∞ –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç.";
    box.appendChild(empty);
    return;
  }

  for(const e of entries){
    const cat = state.categories.find(c=>c.id===e.catId);
    const item = document.createElement("div");
    item.className = "item";

    const l = document.createElement("div");
    l.className = "l";

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = `${cat ? (cat.emoji+" "+cat.name) : "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"} ‚Äî ${e.minutes} –º–∏–Ω`;

    const meta = document.createElement("div");
    meta.className = "meta";
    const t = new Date(e.ts).toLocaleTimeString("ru-RU", {hour:"2-digit", minute:"2-digit"});
    meta.textContent = `–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏: ${t}`;

    l.appendChild(title);
    l.appendChild(meta);

    const del = document.createElement("button");
    del.className = "mini danger";
    del.textContent = "–£–¥–∞–ª–∏—Ç—å";
    del.onclick = () => deleteEntry(e.id);

    item.appendChild(l);
    item.appendChild(del);
    box.appendChild(item);
  }
}

function rerender(){
  saveState();
  renderStats();
  renderCats();
  renderEntries();
}

/** ===== Actions ===== */
function addCategory(){
  const emoji = $("catEmoji").value.trim() || "üî∑";
  const name = $("catName").value.trim();

  if(!name){
    alert("–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –†–∞–±–æ—Ç–∞).");
    return;
  }

  state.categories.unshift({ id: uid(), emoji, name });
  $("catEmoji").value = "";
  $("catName").value = "";
  rerender();
}

function deleteCategory(catId){
  const cat = state.categories.find(c=>c.id===catId);
  if(!cat) return;
  const ok = confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${cat.name}"?\n(–ó–∞–ø–∏—Å–∏ –∑–∞ –ø—Ä–æ—à–ª—ã–µ –¥–Ω–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.)`);
  if(!ok) return;

  // remove category
  state.categories = state.categories.filter(c=>c.id!==catId);

  // keep entries but they will show as "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
  rerender();
}

function addMinutesFlow(catId){
  const cat = state.categories.find(c=>c.id===catId);
  const label = cat ? `${cat.emoji} ${cat.name}` : "–ö–∞—Ç–µ–≥–æ—Ä–∏—è";
  const raw = prompt(`–°–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –ø–æ—Ç—Ä–∞—Ç–∏–ª –Ω–∞: ${label}?`, "30");
  if(raw === null) return;

  const minutes = clampInt(raw);
  if(minutes <= 0){
    alert("–ù—É–∂–Ω–æ —á–∏—Å–ª–æ –º–∏–Ω—É—Ç –±–æ–ª—å—à–µ 0.");
    return;
  }

  ensureToday();
  state.days[today].entries.push({ id: uid(), catId, minutes, ts: nowTs() });
  rerender();
}

function deleteEntry(entryId){
  ensureToday();
  const ok = confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?");
  if(!ok) return;
  state.days[today].entries = state.days[today].entries.filter(e=>e.id!==entryId);
  rerender();
}

function newDay(){
  const ok = confirm("–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å –∏ –æ—á–∏—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Å–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è?");
  if(!ok) return;
  ensureToday();
  state.days[today].entries = [];
  rerender();
}

/** ===== Weekly chart ===== */
function last7DaysKeys(){
  const res = [];
  const d = new Date();
  for(let i=6;i>=0;i--){
    const x = new Date(d);
    x.setDate(d.getDate()-i);
    res.push(dayKey(x));
  }
  return res;
}

function dayTotal(key){
  const day = state.days[key];
  if(!day || !day.entries) return 0;
  return day.entries.reduce((a,e)=>a+e.minutes,0);
}

function topCats7Days(){
  const keys = last7DaysKeys();
  const map = new Map(); // catId -> minutes
  for(const k of keys){
    const day = state.days[k];
    if(!day) continue;
    for(const e of day.entries){
      map.set(e.catId, (map.get(e.catId)||0) + e.minutes);
    }
  }
  const arr = Array.from(map.entries()).map(([catId, minutes])=>{
    const c = state.categories.find(x=>x.id===catId);
    return { catId, minutes, label: c ? `${c.emoji} ${c.name}` : "–ö–∞—Ç–µ–≥–æ—Ä–∏—è" };
  });
  arr.sort((a,b)=>b.minutes-a.minutes);
  return arr.slice(0,8);
}

function drawWeekChart(){
  const canvas = $("weekCanvas");
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;

  // clear
  ctx.clearRect(0,0,W,H);

  const keys = last7DaysKeys();
  const totals = keys.map(dayTotal);
  const max = Math.max(60, ...totals); // avoid 0 max
  const padL = 60, padR = 20, padT = 20, padB = 60;
  const innerW = W - padL - padR;
  const innerH = H - padT - padB;

  // axes
  ctx.globalAlpha = 1;
  ctx.lineWidth = 1;
  ctx.strokeStyle = "rgba(255,255,255,0.12)";
  ctx.beginPath();
  ctx.moveTo(padL, padT);
  ctx.lineTo(padL, padT + innerH);
  ctx.lineTo(padL + innerW, padT + innerH);
  ctx.stroke();

  // grid + labels (Y)
  ctx.fillStyle = "rgba(232,238,252,0.85)";
  ctx.font = "14px system-ui";
  const ticks = 4;
  for(let i=0;i<=ticks;i++){
    const v = Math.round((max * (ticks-i))/ticks);
    const y = padT + (innerH * i)/ticks;

    ctx.strokeStyle = "rgba(255,255,255,0.06)";
    ctx.beginPath();
    ctx.moveTo(padL, y);
    ctx.lineTo(padL + innerW, y);
    ctx.stroke();

    ctx.fillStyle = "rgba(159,176,208,0.9)";
    ctx.fillText(String(v), 12, y+5);
  }

  // bars
  const gap = 12;
  const barW = (innerW - gap*(keys.length-1)) / keys.length;

  for(let i=0;i<keys.length;i++){
    const val = totals[i];
    const h = (val / max) * innerH;
    const x = padL + i*(barW+gap);
    const y = padT + innerH - h;

    // bar
    ctx.fillStyle = "rgba(77,163,255,0.85)";
    ctx.fillRect(x, y, barW, h);

    // day label
    ctx.fillStyle = "rgba(159,176,208,0.95)";
    ctx.font = "13px system-ui";
    const label = fmtDateRu(keys[i]); // "–ø–Ω, 11.01" style
    // rotate a bit for readability
    ctx.save();
    ctx.translate(x + barW/2, padT + innerH + 38);
    ctx.rotate(-0.35);
    ctx.textAlign = "center";
    ctx.fillText(label, 0, 0);
    ctx.restore();

    // value label on top (minutes)
    ctx.fillStyle = "rgba(232,238,252,0.9)";
    ctx.font = "13px system-ui";
    ctx.textAlign = "center";
    ctx.fillText(String(val), x + barW/2, y - 6);
  }

  // title
  ctx.fillStyle = "rgba(232,238,252,0.95)";
  ctx.font = "16px system-ui";
  ctx.textAlign = "left";
  ctx.fillText("–ú–∏–Ω—É—Ç—ã –ø–æ –¥–Ω—è–º (7 –¥–Ω–µ–π)", padL, 18);

  // reset align
  ctx.textAlign = "left";
}

function openWeek(){
  drawWeekChart();

  const top = topCats7Days();
  const box = $("topCats");
  box.innerHTML = "";
  if(top.length === 0){
    const d = document.createElement("div");
    d.className = "hint";
    d.textContent = "–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é.";
    box.appendChild(d);
  } else {
    for(const t of top){
      const pill = document.createElement("div");
      pill.className = "pill";
      pill.innerHTML = `<span>${t.label}</span><span class="m">${t.minutes} –º–∏–Ω</span>`;
      box.appendChild(pill);
    }
  }

  $("weekDialog").showModal();
}

/** ===== Init ===== */
$("addCatBtn").addEventListener("click", addCategory);
$("newDayBtn").addEventListener("click", newDay);
$("weekBtn").addEventListener("click", openWeek);
$("closeWeek").addEventListener("click", () => $("weekDialog").close());

renderHeader();
ensureToday();
rerender();
</script>
</body>
</html>
